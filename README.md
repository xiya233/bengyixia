# ğŸƒ è¹¦å½ä¸‹ - æ¯æ—¥è·³ç»³è®°å½•

ä¸€ä¸ªç®€æ´ä¼˜é›…çš„æ¯æ—¥è·³ç»³è®°å½• Web åº”ç”¨ï¼Œå¸®åŠ©ä½ è¿½è¸ªå’Œå¯è§†åŒ–è‡ªå·±çš„è·³ç»³è¿åŠ¨æ•°æ®ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ“Š æ•°æ®è®°å½•ä¸å¯è§†åŒ–
- **çƒ­åŠ›å›¾**ï¼šGitHub é£æ ¼çš„å¹´åº¦è·³ç»³çƒ­åŠ›å›¾ï¼Œç›´è§‚å±•ç¤ºè¿åŠ¨é¢‘ç‡
- **æŠ˜çº¿å›¾**ï¼šæŒ‰æœˆå±•ç¤ºè·³ç»³æ¬¡æ•°è¶‹åŠ¿å˜åŒ–
- **æŸ±çŠ¶å›¾**ï¼šæŒ‰æœˆå¯¹æ¯”è·³ç»³æ•°æ®
- **æ—¥æœŸç­›é€‰**ï¼šæ”¯æŒæŒ‰å¹´ä»½ã€è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´æŸ¥çœ‹æ•°æ®

### ğŸ‘¤ ç”¨æˆ·ç³»ç»Ÿ
- **æ³¨å†Œ / ç™»å½•**ï¼šæ”¯æŒç”¨æˆ·æ³¨å†Œå’Œç™»å½•ï¼Œæ•°å­¦éªŒè¯ç é˜²æŠ¤
- **ä¸ªäººèµ„æ–™**ï¼šè‡ªå®šä¹‰å¤´åƒã€ä¸ªäººç®€ä»‹
- **å¯†ç ä¿®æ”¹**ï¼šæ”¯æŒä¿®æ”¹ç™»å½•å¯†ç ï¼ˆéœ€éªŒè¯æ—§å¯†ç ï¼‰
- **è§’è‰²ç®¡ç†**ï¼šç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·è‡ªåŠ¨æˆä¸ºç®¡ç†å‘˜

### ğŸ”— æ•°æ®åˆ†äº«
- **åˆ†äº«é¡µé¢**ï¼šç”Ÿæˆ UUID é£æ ¼çš„é“¾æ¥ï¼Œåˆ†äº«ä½ çš„è¿åŠ¨æ•°æ®
- **å¯åµŒå…¥å°æŒ‚ä»¶**ï¼šç”ŸæˆåµŒå…¥ä»£ç ï¼Œå°†çƒ­åŠ›å›¾/æŠ˜çº¿å›¾/æŸ±çŠ¶å›¾å±•ç¤ºåœ¨ä¸ªäººåšå®¢
- **ä¸»é¢˜è·Ÿéš**ï¼šåˆ†äº«é¡µé¢éµå¾ªç”¨æˆ·é€‰æ‹©çš„æµ…è‰²/æ·±è‰²ä¸»é¢˜

### ğŸ› ï¸ ç®¡ç†é¢æ¿
- **ç”¨æˆ·ç®¡ç†**ï¼šæŸ¥çœ‹ã€å°ç¦ã€è§£å°ã€åˆ é™¤ç”¨æˆ·ï¼Œæ‰‹åŠ¨æ·»åŠ æ–°ç”¨æˆ·
- **ç½‘ç«™è®¾ç½®**ï¼š
  - å¯ç”¨/å…³é—­ç”¨æˆ·æ³¨å†Œ
  - å¯ç”¨/å…³é—­éªŒè¯ç 
  - è‡ªå®šä¹‰ç½‘ç«™æ ‡é¢˜å’Œæè¿°
  - è®¾ç½®ç”¨æˆ·å¤´åƒä¸Šä¼ å¤§å°é™åˆ¶ï¼ˆ1-20MBï¼‰
- **å…¬å‘Šç®¡ç†**ï¼šå‘å¸ƒå’Œåˆ é™¤å…¬å‘Šï¼Œå…¬å‘Šæ˜¾ç¤ºåœ¨é¦–é¡µ

## ğŸ§± æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| **æ¡†æ¶** | [Next.js](https://nextjs.org/) 16 (App Router, Server Actions) |
| **è¯­è¨€** | TypeScript |
| **è¿è¡Œæ—¶** | [Bun](https://bun.sh/) |
| **å‰ç«¯** | React 19, Tailwind CSS 4 |
| **UI ç»„ä»¶** | [shadcn/ui](https://ui.shadcn.com/), Radix UI, Lucide Icons |
| **å›¾è¡¨** | [Recharts](https://recharts.org/) |
| **æ•°æ®åº“** | SQLiteï¼ˆé€šè¿‡ [better-sqlite3](https://github.com/WiseLibs/better-sqlite3)ï¼‰ |
| **ORM** | [Drizzle ORM](https://orm.drizzle.team/) |
| **è®¤è¯** | JWTï¼ˆ[jose](https://github.com/panva/jose)ï¼‰+ bcryptjs å¯†ç å“ˆå¸Œ |
| **å›¾ç‰‡å¤„ç†** | [sharp](https://sharp.pixelplumbing.com/)ï¼ˆå¤´åƒè£å‰ªå‹ç¼©ï¼‰ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ actions/            # Server Actions
â”‚   â”‚   â”œâ”€â”€ auth.ts         # æ³¨å†Œã€ç™»å½•ã€ç™»å‡º
â”‚   â”‚   â”œâ”€â”€ records.ts      # è·³ç»³è®°å½• CRUD
â”‚   â”‚   â”œâ”€â”€ settings.ts     # ç«™ç‚¹è®¾ç½®ã€å…¬å‘Šç®¡ç†
â”‚   â”‚   â”œâ”€â”€ share.ts        # åˆ†äº«åŠŸèƒ½
â”‚   â”‚   â””â”€â”€ user.ts         # ä¸ªäººèµ„æ–™ã€å¤´åƒä¸Šä¼ ã€å¯†ç ä¿®æ”¹
â”‚   â”œâ”€â”€ admin/              # ç®¡ç†é¢æ¿
â”‚   â”œâ”€â”€ api/captcha/        # éªŒè¯ç  API
â”‚   â”œâ”€â”€ dashboard/          # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ embed/[token]/      # å¯åµŒå…¥å°æŒ‚ä»¶
â”‚   â”œâ”€â”€ profile/            # ä¸ªäººèµ„æ–™
â”‚   â””â”€â”€ share/[token]/      # åˆ†äº«é¡µé¢
â”œâ”€â”€ components/             # React ç»„ä»¶
â”‚   â”œâ”€â”€ CalendarHeatmap.tsx  # çƒ­åŠ›å›¾
â”‚   â”œâ”€â”€ JumpCharts.tsx      # æŠ˜çº¿å›¾ & æŸ±çŠ¶å›¾
â”‚   â”œâ”€â”€ RecordForm.tsx      # è®°å½•è¡¨å•
â”‚   â””â”€â”€ ThemeToggle.tsx     # ä¸»é¢˜åˆ‡æ¢
â”œâ”€â”€ db/                     # æ•°æ®åº“
â”‚   â”œâ”€â”€ index.ts            # è¿æ¥ & åˆå§‹åŒ–
â”‚   â””â”€â”€ schema.ts           # Drizzle Schema
â”œâ”€â”€ lib/                    # å·¥å…·åº“
â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯
â”‚   â”œâ”€â”€ captcha.ts          # éªŒè¯ç ç”Ÿæˆ & éªŒè¯
â”‚   â””â”€â”€ utils.ts            # é€šç”¨å·¥å…·
â””â”€â”€ middleware.ts            # è·¯ç”±ä¸­é—´ä»¶
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œæœ‰é»˜è®¤å€¼ï¼‰ï¼š

```env
# JWT ç­¾åå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¼ºçƒˆå»ºè®®ä¿®æ”¹ï¼‰
JWT_SECRET=your-super-secure-random-key-here

# éªŒè¯ç ç­¾åå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¼ºçƒˆå»ºè®®ä¿®æ”¹ï¼‰
CAPTCHA_SECRET=your-captcha-secret-key-here

# ç«¯å£ï¼ˆé»˜è®¤ 3000ï¼‰
PORT=3000
```

> **âš ï¸ å®‰å…¨æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒåŠ¡å¿…è®¾ç½®è‡ªå®šä¹‰çš„ `JWT_SECRET` å’Œ `CAPTCHA_SECRET`ï¼Œä¸è¦ä½¿ç”¨é»˜è®¤å€¼ã€‚

---

### æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨éƒ¨ç½²

#### å‰ç½®è¦æ±‚

- [Bun](https://bun.sh/) >= 1.0ï¼ˆæ¨èï¼‰æˆ– [Node.js](https://nodejs.org/) >= 18
- Git

#### æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/bengyixia.git
cd bengyixia

# 2. å®‰è£…ä¾èµ–
bun install

# 3. æ„å»ºé¡¹ç›®
bun run build

# 4. å¯åŠ¨æœåŠ¡
bun run start
```

åº”ç”¨é»˜è®¤è¿è¡Œåœ¨ `http://localhost:3000`ã€‚

#### ä½¿ç”¨ PM2 å®ˆæŠ¤è¿›ç¨‹ï¼ˆæ¨èï¼‰

```bash
# å®‰è£… PM2
bun add -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start bun --name bengyixia -- run start

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 save
pm2 startup
```

#### ä½¿ç”¨ systemd å®ˆæŠ¤è¿›ç¨‹

åˆ›å»º `/etc/systemd/system/bengyixia.service`ï¼š

```ini
[Unit]
Description=Bengyixia Jump Rope Tracker
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/path/to/bengyixia
Environment=NODE_ENV=production
Environment=JWT_SECRET=your-secret-here
ExecStart=/usr/local/bin/bun run start
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable --now bengyixia
```

#### åå‘ä»£ç†ï¼ˆNginxï¼‰

```nginx
server {
    listen 80;
    server_name your-domain.com;

    client_max_body_size 20M;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

---

### æ–¹å¼äºŒï¼šDocker Compose éƒ¨ç½²

#### 1. åˆ›å»º Dockerfile

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `Dockerfile`ï¼š

```dockerfile
FROM oven/bun:1 AS base
WORKDIR /app

# å®‰è£…ä¾èµ–
FROM base AS deps
COPY package.json bun.lock ./
RUN bun install --frozen-lockfile

# æ„å»º
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN bun run build

# è¿è¡Œ
FROM base AS runner
WORKDIR /app
ENV NODE_ENV=production

# åˆ›å»ºé root ç”¨æˆ·
RUN addgroup --system --gid 1001 nodejs && \
    adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

# æ•°æ®æŒä¹…åŒ–ç›®å½•
RUN mkdir -p /app/data /app/public/uploads && \
    chown -R nextjs:nodejs /app/data /app/public/uploads

USER nextjs

EXPOSE 3000
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

CMD ["bun", "server.js"]
```

> **æ³¨æ„**ï¼šDocker æ„å»ºä½¿ç”¨ `standalone` è¾“å‡ºæ¨¡å¼ï¼Œéœ€è¦åœ¨ `next.config.ts` ä¸­æ·»åŠ ï¼š
> ```ts
> output: "standalone",
> ```

#### 2. åˆ›å»º docker-compose.yml

```yaml
services:
  bengyixia:
    build: .
    container_name: bengyixia
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - JWT_SECRET=your-super-secure-random-key-here
      - CAPTCHA_SECRET=your-captcha-secret-key-here
    volumes:
      - ./data:/app/data          # SQLite æ•°æ®åº“æŒä¹…åŒ–
      - ./uploads:/app/public/uploads  # ç”¨æˆ·å¤´åƒæŒä¹…åŒ–
```

#### 3. å¯åŠ¨

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f bengyixia

# åœæ­¢
docker compose down
```

#### 4. é…åˆ Nginx åå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name your-domain.com;

    client_max_body_size 20M;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

---

## ğŸ“ æ•°æ®å­˜å‚¨

- **æ•°æ®åº“**ï¼šSQLite æ–‡ä»¶å­˜å‚¨åœ¨ `data/` ç›®å½•ï¼Œé¦–æ¬¡å¯åŠ¨è‡ªåŠ¨åˆ›å»ºå’Œåˆå§‹åŒ–
- **å¤´åƒæ–‡ä»¶**ï¼šå­˜å‚¨åœ¨ `public/uploads/` ç›®å½•
- **å¤‡ä»½**ï¼šåªéœ€å¤‡ä»½ `data/` å’Œ `public/uploads/` ç›®å½•å³å¯

## ğŸ¨ ä¸»é¢˜

æ”¯æŒæµ…è‰²å’Œæ·±è‰²ä¸¤ç§ä¸»é¢˜ï¼Œé€šè¿‡é¡µé¢å³ä¸Šè§’çš„æŒ‰é’®åˆ‡æ¢ï¼Œåå¥½è®¾ç½®å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License
